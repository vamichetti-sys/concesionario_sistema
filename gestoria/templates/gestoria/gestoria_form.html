{% extends "base.html" %}

{% block title %}Ficha de GestorÃ­a{% endblock %}

{% block content %}
<div class="container-fluid">

    <!-- ===============================
         HEADER OPERATIVO
    =============================== -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
        <div class="card-body">

            <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">

                <!-- DATOS -->
                <div>
                    <h2 class="fw-bold mb-1" style="color:#002855;">
                        Ficha de GestorÃ­a
                    </h2>

                    <div class="row mt-3 g-3">
                        <div class="col-md-6">
                            <div class="fw-semibold">VehÃ­culo</div>
                            <div class="text-muted">
                                {{ gestoria.vehiculo }}
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="fw-semibold">Cliente</div>
                            <div class="text-muted">
                                {{ gestoria.cliente_actual }}
                                {% if gestoria.venta and gestoria.venta.cliente %}
                                    Â· DNI {{ gestoria.venta.cliente.dni }}
                                    {% if gestoria.venta.cliente.telefono %}
                                        Â· ðŸ“ž
                                        <a href="tel:{{ gestoria.venta.cliente.telefono }}"
                                           class="text-decoration-none fw-semibold">
                                            {{ gestoria.venta.cliente.telefono }}
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ACCIÃ“N VEHÃCULO (URL REAL) -->
                <div class="mt-1">
                    <a href="{% url 'vehiculos:ficha_completa' gestoria.vehiculo.id %}"
                       class="btn btn-outline-primary rounded-pill px-4">
                         Ver ficha del vehÃ­culo
                    </a>
                </div>

            </div>

        </div>
    </div>

    <form method="post">
        {% csrf_token %}

        <div class="row g-4">

            <!-- ===============================
                 ESTADO DE TRANSFERENCIA
            =============================== -->
            <div class="col-12">
                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-body">

                        <h5 class="fw-bold mb-3" style="color:#002855;">
                            Estado de la transferencia
                        </h5>

                        <div class="row g-3 align-items-end">
                            <div class="col-md-4">
                                {{ form.estado.label_tag }}
                                {{ form.estado }}
                            </div>

                            <div class="col-md-8">
                                {{ form.observaciones.label_tag }}
                                {{ form.observaciones }}
                            </div>
                        </div>

                        {% if gestoria.estado == "finalizada" %}
                            <div class="alert alert-success small mt-3 mb-0">
                                Transferencia finalizada el
                                {{ gestoria.fecha_finalizacion|date:"d/m/Y H:i" }}
                            </div>
                        {% endif %}

                    </div>
                </div>
            </div>

            <!-- ===============================
                 ADMINISTRATIVO / CUENTA CORRIENTE
            =============================== -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-body">

                        <h5 class="fw-bold mb-3" style="color:#002855;">
                            Datos administrativos
                        </h5>

                        <div class="mb-3">
                            <label class="fw-semibold">
                                Monto de transferencia
                            </label>
                            {{ form.monto_transferencia }}
                        </div>

                        <div class="form-check mb-2">
                            {{ form.pagado }}
                            <label class="form-check-label fw-semibold">
                                Pago recibido
                            </label>
                        </div>

                        <div class="form-check mb-2">
                            {{ form.transferido }}
                            <label class="form-check-label fw-semibold">
                                Transferencia realizada
                            </label>
                        </div>

                        <!-- ðŸ”’ VÃNCULO CON CUENTA CORRIENTE -->
                        {% if gestoria.cuenta_corriente %}
                        <div class="alert alert-info small mt-3 mb-0">
                            Vinculado a Cuenta Corriente
                            <strong>#{{ gestoria.cuenta_corriente.id }}</strong>
                        </div>
                        {% endif %}

                    </div>
                </div>
            </div>

            <!-- ===============================
                 DOCUMENTACIÃ“N
            =============================== -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-body">

                        <h6 class="fw-bold mb-3 text-muted">
                            DocumentaciÃ³n (referencial)
                        </h6>

                        <div class="row g-3">

                            <div class="col-md-6">
                                <div class="form-check">
                                    {{ form.formulario_08 }}
                                    <label class="form-check-label">
                                        Formulario 08
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    {{ form.titulo }}
                                    <label class="form-check-label">
                                        TÃ­tulo
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    {{ form.cedula }}
                                    <label class="form-check-label">
                                        CÃ©dula
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    {{ form.informe_dominio }}
                                    <label class="form-check-label">
                                        Informe de dominio
                                    </label>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>

        </div>

        <!-- ===============================
             ACCIONES
        =============================== -->
        <div class="mt-4 d-flex gap-2">
            <button type="submit" class="btn btn-primary px-4">
                Guardar cambios
            </button>

            <a href="{% url 'gestoria:vigentes' %}"
               class="btn btn-secondary px-4">
                Volver
            </a>
        </div>

    </form>

</div>
{% endblock %}
