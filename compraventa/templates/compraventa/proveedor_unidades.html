{% extends "base.html" %}
{% block title %}Unidades del proveedor{% endblock %}
{% block content %}
<h3 class="fw-bold mb-4">
  Unidades — {{ proveedor.nombre_empresa }}
</h3>

<a href="{% url 'compraventa:proveedor_detalle' proveedor.id %}"
   class="btn btn-secondary mb-3">
  Volver al proveedor
</a>

<div class="card shadow-sm rounded-4 p-4">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Vehículo</th>
        <th class="text-end">Precio compra</th>
        <th class="text-end">Total pagado</th>
        <th class="text-end">Saldo</th>
        <th class="text-end">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for op in operaciones %}
      <tr>
        <!-- VEHÍCULO -->
        <td>
          {{ op.vehiculo.marca }} {{ op.vehiculo.modelo }}
          <br>
          <small class="text-muted">
            {{ op.vehiculo.dominio|default:"Sin dominio" }}
          </small>
        </td>

        <!-- PRECIO COMPRA -->
        <td class="text-end">
          ${{ op.precio_compra|floatformat:2|default:"0" }}
        </td>

        <!-- TOTAL PAGADO -->
        <td class="text-end text-success">
          ${{ op.total_pagado_vehiculo|floatformat:2|default:"0" }}
        </td>

        <!-- SALDO -->
        <td class="text-end fw-bold
          {% if op.deuda_vehiculo > 0 %}
            text-danger
          {% else %}
            text-success
          {% endif %}
        ">
          ${{ op.deuda_vehiculo|floatformat:2|default:"0" }}
        </td>

        <!-- ACCIONES -->
        <td class="text-end">
          <a href="{% url 'vehiculos:ficha_completa' op.vehiculo.id %}"
             class="btn btn-outline-secondary btn-sm me-1">
            Ver ficha
          </a>
          {% if op.vehiculo.deuda_proveedor %}
            <a href="{% url 'compraventa:deuda_editar' op.vehiculo.deuda_proveedor.id %}"
               class="btn btn-outline-secondary btn-sm me-1">
              Editar
            </a>
            {% if op.deuda_vehiculo > 0 %}
              <a href="{% url 'compraventa:deuda_pago' op.vehiculo.deuda_proveedor.id %}"
                 class="btn btn-primary btn-sm">
                Registrar pago
              </a>
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-muted">
          No hay unidades vinculadas a este proveedor.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}